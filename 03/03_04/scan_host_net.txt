Сканирование узлов сети

Сканирование узлов сети работает благодаря устройству таких протоколов, как: ICMP, TCP/UDP и ARP

    ICMP — это протокол сетевого уровня стека TCP/IP, предназначенный для передачи сервисных сообщений на низком (сетевом) уровне. Обычно используется для передачи сообщений об ошибках и других исключительных ситуациях, возникших при передаче данных, например, недоступность узла. ICMP включает в себя несколько типов сообщений, и в их числе echo request(8) и echo responce(0), которые используются для проверки доступности: если узлы получил эхо-запрос, он отправляет обратно эхо-ответ, что говорит об его доступности

Довольно часто ICMP-трафик в сети может быть заблокирован администраторами, поэтому обнаружить узлы обычным эхо-запросом не выйдет. В таком случае можно просто отправить TCP или UDP сообщение на какой-нибудь порт, и если ответ придет, делаем вывод, что узел под этим адресом существует в сети.

    ARP — это протокол канального уровня, позволяющий узнать MAC-адрес узла по его IP и наоборот. MAC-адрес, как и IP,может быть полезной информацией для исследователя, но он может быть получен таким образом в пределах одной локальной сети, так как ARP-запрос отправляется по broadcast MAC-адресу (FF:FF:FF:FF:FF:FF) и ограничивается одной подсетью.


Алгоритм действий по сканированию узлов сети

На примере самого распространенного сканера сети Nmap рассмотрим, как можно просканировать произвольное пространство сети.

    Определить адрес подсети, в которой будет производится поиск узлов. Например, 192.168.0.0/24
    Провести Ping-сканирование сети: nmap -sn --traceroute <network>
        -sn — ping-сканирование. По умолчанию посылаются запрос на ICMP,эхо-запрос и TCP-ACK пакет на порт 80.
        --traceroute — также для того, чтобы проводить трассировку маршрута до каждого найденного узла. Эта опция может помочь в составлении карты подсети.
    Если есть подозрение, что ICMP-пакеты и TCP-ACK сообщения блокируются сетевым экраном, можно применить другие виды сканирования:
        -PS — TCP-SYN сканирование
        -PU — UDP сканирование 
        -PE; -PP; -PM — ICMP-сканирование других типов: запрос временной метки (13), информационный запрос (15), запрос адресной маски (17). Многие узлы и брандмауэры могут блокировать исключительно ICMP-пакеты типа echo request, но в спецификации ICMP присутствуют еще несколько типов запросов, позволяющих получить ответ от узлов.
    Если после выполнения команд Nmap предоставил список доступных узлов, то сканирование может считаться успешным.

см. картинку

В данном примере используется флаг -sn, отключающий сканирование портов на обнаруженных узлах; он нужен, чтобы сократить время сканирования и исключить поиск сервисов. Флаг -sn не указывается, так как он используется при сканировании по умолчанию.

Nmap в выводе выдал:

    IP-адрес 192.168.88.1
    MAC адрес производителя сетевой карты:2C:C8:1B:56:C7:39 (Routerboard.com)

А также продемонстрировал прямой маршрут traceroute до узла, заключающийся в одном "прыжке" до адреса роутера (это расстояние также называется "хопом" от английского слова "hop", англ. "hop" - "прыжок"; термин используется в описании сетевых протоколов IP и пр.).



Когда и как применять сканирование узлов сети?

Сканирование сети применяется на начальном этапе сбора информации для получения информации об используемых IP-адресах в сети. Сканирование применяют при отсутствии какой-либо подобной информации о сети и инфраструктуре.

Эта техника дает информацию о доступных устройствах в сети. Однако она дает информацию только об их существовании и доступности, и не более того, в отличие от техники сканирования портов,  дополнительно дающей информацию об открытых портах и сервисах, запущенных на них.

Для применения этой техники как минимум должен быть известен адрес целевой подсети, все остальное выполняет сетевой сканер.

Сканирование сети — самый быстрый и эффективный способ обнаружение узлов в сети, однако это активный метод сбора информации, и использование этой техники несет за собой высокий риск обнаружения, так как большинство современных анализаторов трафика и IDS/IPS-систем умеют распознавать работу сетевого сканера, поэтому технику стоит использовать в случаях, когда скрытность не имеет особого значения для хакера.

