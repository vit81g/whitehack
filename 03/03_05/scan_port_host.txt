
Как работает сканирование портов

Данная техника строится на особенностях реализации протоколов транспортного уровня, где происходит распределение трафика между приложениями системы за счёт перенаправления его на сетевые порты.

    Сетевой порт представляет собой число от 1 до 65535, указанное и известное обоим приложениям, между которыми устанавливается связь.

На данном уровне два самых популярных протокола TCP и UDP. На основе их поведения в сети наши инструменты могут делать выводы о том, есть ли возможность взаимодействия с портом или нет, т.е. сообщать нам о том, открыт порт или закрыт.

Исследуем поведения этих двух популярных протоколов, чтобы понимать, как сканер определяет их открытость.

Протокол TCP

При использовании протокола TCP образуется соединение, которое гарантирует отправку тех или иных сетевых пакетов, и происходит контролирование порядка следования сетевых пакетов. Это происходит через механизм трехэтапного рукопожатия:

1. Клиент отправляет сетевой пакет с установленным флагом SYN. При этом пакету присваивается произвольный порядковый номер (sequence number) в интервале от 1 до 232 (т.н. initial sequence number), относительно которого будет вестись дальнейший отсчет последовательности пакетов в соединении.

2. Сервер получает запрос и отправляет ответный пакет с одновременно установленными флагами SYN+ACK, при этом записывает в поле «номер подтверждения» (acknowledgement number), полученный порядковый номер, увеличенный на 1 (что подтверждает получение первого пакета), а также устанавливает свой порядковый номер, который, как и в SYN-пакете, выбирается произвольно.

3. После получения клиентом пакета с флагами SYN+ACK соединение считается установленным, клиент, в свою очередь, отправляет в ответ пакет с флагом ACK, обновленными номерами последовательности и не содержащий полезной нагрузки.

Если сервис на открытом сетевом порту начинает обмениваться с нами вторым шагом трех-этапного рукопожатия, то он существует и доступен для взаимодействия. И наоборот, если сервис не отвечает нам или возвращает пакет, отличный от пакета с флагами SYN+ACK, то порт фильтруется или закрыт.

Протокол UDP

При использовании протоколаUDP сетевой пакет просто отправляется по сети до указанного узла на указанный порт, при этом нет гарантии, что пакет дойдёт до адресата, также никак не контролируется порядок следования пакетов. Однако при использовании этого протокола пакет если и достигает адресата, то это происходит намного быстрее, чем при TCP.

Открытость или закрытость данного порта определяется с помощью ICMP ответов на отправленные UDP пакеты. Если порт не активен, то удаленный узел отправляет нам ответ по протоколу ICMP: port-unreachable.

    Данный метод не эффективен, если происходит фильтрация ICMP пакетов с помощью FireWall.

